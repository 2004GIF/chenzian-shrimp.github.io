# 微服务保护 —— Sentinel
## 限流（微服务提供者）
作用：控制访问微服务的 QPS 数量
实现方式直接在 sentinel 控制台中给对应的簇点添加流控规则设置 QPS 即可

## 线程隔离（Thread Isolation）
   - **定义**：线程隔离在Sentinel中通常是通过并发线程数控制实现的。它限制了一个资源可以同时使用的线程数，从而避免单个资源占用过多线程导致服务崩溃。
   - **目的**：防止某个热点资源（如数据库查询）占用过多线程，影响其他资源的处理能力。
   - **实现方式**：通过设置资源的`maxConcurrentThreads`（最大并发线程数）来实现。当线程数达到这个阈值时，新的请求将会被拒绝。
   - **优点**：可以有效地限制资源的使用，防止系统过载。
   - **缺点**：需要合理配置线程数，以避免资源浪费或限制过严。
## 服务熔断（Service Circuit Breaker）
   - **定义**：服务熔断在Sentinel中是通过设置错误比例阈值或响应时间阈值来实现的。当资源的错误比例或响应时间超过阈值时，Sentinel会自动触发熔断，阻止后续请求访问该资源。
   - **目的**：防止系统不断地尝试执行可能失败的调用，给系统一个恢复的时间窗口。
   - **实现方式**：通过设置资源的`errorRatio`（错误比例）或`slowRatio`（慢调用比例）来实现。当这些指标超过阈值时，熔断器会打开，后续请求会被快速失败处理。
   - **优点**：可以快速失败，防止级联故障，给系统恢复的时间。
   - **缺点**：可能会错误地断开正常服务，需要根据实际情况调整阈值。

在Sentinel中，线程隔离和服务熔断通常是结合使用的，以提供更全面的保护。线程隔离关注的是资源的并发使用控制，而服务熔断关注的是资源的错误率和响应时间。通过合理配置这些参数，可以有效地提高系统的稳定性和可用性。

## 在微服务架构中，限流、线程隔离和服务熔断通常是结合使用的

1. **结合使用的优势**：
   - **互补性**：限流：从服务提供者进行了访问的控制 ，从而实现方访问过多导致微服务处理不过来的问题， 线程隔离主要限制单个资源的并发使用，防止资源过载；而服务熔断则关注于资源的错误率和响应时间，防止系统不断尝试可能失败的调用 。两者结合可以更全面地保护系统 。
   - **多层次保护**：线程隔离在资源级别提供保护，服务熔断在服务级别提供保护。这种多层次的保护可以有效地防止各种故障场景。
   - **快速失败和恢复**：**服务熔断可以快速失败，防止级联故障**，并为系统提供恢复的时间窗口。**线程隔离**则确保系统在面临问题时仍然可以**部分运行**。
2. **这两种方案都会触发 FallBack 机制**
   1. **FallBack** ： 当服务的提供者出现一些问题的时候，导致调用者无法正常使用就会触发备用方案。
